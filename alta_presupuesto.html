<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Simulación de Presupuestos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Estilos generales */
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2, h3 {
      text-align: center;
      color: #333;
    }
    p.explicacion {
      font-size: 14px;
      color: #555;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    /* Pantalla de selección */
    .select-type {
      text-align: center;
      margin: 40px 0;
    }
    .select-type button {
      padding: 15px 30px;
      font-size: 16px;
      margin: 10px;
      background: #69b6b1;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .select-type button:hover {
      background: #89c5c0;
    }
    /* Barra de progreso (train stops) */
    .progressbar {
      list-style: none;
      display: flex;
      justify-content: space-between;
      counter-reset: step;
      margin: 20px 0;
      padding-left: 0;
    }
    .progressbar li {
      flex: 1;
      text-align: center;
      position: relative;
      font-size: 14px;
      text-transform: uppercase;
      color: #ccc;
    }
    .progressbar li:before {
      content: counter(step);
      counter-increment: step;
      width: 30px;
      height: 30px;
      line-height: 30px;
      border: 2px solid #ccc;
      display: block;
      text-align: center;
      margin: 0 auto 10px auto;
      border-radius: 50%;
      background-color: #fff;
    }
    .progressbar li.active {
      color: #69b6b1;
    }
    .progressbar li.active:before {
      border-color: #69b6b1;
    }
    /* Estilos para formularios wizard */
    .wizard-step {
      display: none;
    }
    .wizard-step.active {
      display: block;
    }
    .button-group {
      text-align: center;
      margin-top: 20px;
    }
    .btn {
      padding: 10px 20px;
      margin: 5px;
      background: #69b6b1;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn:hover {
      background: #89c5c0;
    }
    
    @media (max-width: 600px) {
      .select-type {
        display: block;
        text-align: center;
      }
      .select-type button {
        display: block;
        width: 100%;
        margin: 10px 0;
      }
    }


    /* Estilos para inputs y secciones */
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    input[readonly] {
      background-color: #eee;
    }
    .small-btn {
      padding: 5px 10px;
      margin-top: 10px;
      background: #ccc;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .small-btn:hover {
      background: #bbb;
    }
    .dynamic-container {
      border: 1px dashed #ccc;
      padding: 10px;
      margin-top: 10px;
    }
    /* Alinear checkboxes verticalmente */
    .checkbox-group-col {
      display: block;
      flex-direction: column;
      gap: 5px;
      margin-top: 10px;
    }
    .checkbox-group-col .checkbox-item {
      display: block;
      align-items: center;
    }
    .checkbox-item input[type="checkbox"] {
      margin-right: 5px;
    }
    /* Alineación de checkboxes para Ubicación de la obra */
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 10px;
    }
    /* Espacio extra entre Vidrio repartido y Escaleras */
    .extra-space {
      margin-top: 20px;
    }
    /* Estilos para campos de totales (calculados) */
    input.calc {
      background-color: #eee;
      font-weight: bold;
    }
    /* Estilos específicos para el formulario Sector */
    .sector-container {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 15px;
      border-radius: 4px;
      background: #fafafa;
    }
    /* Tablas para las medidas en el resumen */
    table.measure-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table.measure-table th,
    table.measure-table td {
      border: 1px solid #ccc;
      padding: 5px;
      text-align: center;
    }
    /* Contenedor para las medidas con scroll y espacio para el botón */
    .medidas-container {
      max-height: 300px; /* Ajustá este valor según convenga */
      overflow-y: auto;
      position: relative;
      padding-bottom: 50px; /* Espacio para que el botón no se superponga */
    }

    /* Botón fijo para agregar medidas */
    .btn-add-medida {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      margin: 10px auto 0;
      background: #69b6b1;
      color: #fff;
      padding: 10px;
      border: none;
      border-radius: 4px;
      z-index: 10;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sistema de Presupuestos</h1>
    
    <!-- Pantalla de selección -->
    <div id="landingPage" class="select-type">
      <h2>Seleccione el tipo de presupuesto</h2>
      <button id="btnPresupuestoGeneral">Presupuesto General</button>
      <button id="btnPresupuestoSector">Presupuesto por Sector</button>
    </div>
    
    <!-- FORMULARIO PRESUPUESTO GENERAL -->
    <div id="formGeneral" class="hidden">
      <h2>Presupuesto General</h2>
      <!-- Barra de progreso -->
      <ul class="progressbar" id="progressGeneral">
        <li class="active">Datos Generales</li>
        <li>Parámetros Generales</li>
        <li>Parámetros Adicionales</li>
        <li>Resumen y Totales</li>
      </ul>
      
      <form id="wizardGeneral">
        <!-- Paso 1: Datos Generales y del Prospecto -->
        <div class="wizard-step active" id="genStep1">
          <h3>Datos Generales y del Prospecto</h3>
          <p class="explicacion">Utilice este presupuesto para proyectos generales.</p>
          <label for="genNumeroPresupuesto">Número de Presupuesto:</label>
          <input type="text" id="genNumeroPresupuesto" name="numero_presupuesto" value="PR-2025-001" readonly>
          
          <label for="genFechaPresupuesto">Fecha de Presupuesto:</label>
          <input type="date" id="genFechaPresupuesto" name="fecha_presupuesto" value="2025-04-07" readonly>
          
          <label for="genVendedor">Vendedor:</label>
          <input type="text" id="genVendedor" name="vendedor" value="Juan Pérez" readonly>
          
          <label for="genEmpresa">Empresa:</label>
          <input type="text" id="genEmpresa" name="empresa" value="Empresa XYZ" readonly>
          
          <label for="genProspecto">Prospecto:</label>
          <select id="genProspecto" name="prospecto">
            <option value="">Seleccione un prospecto</option>
            <option value="1">Prospecto A</option>
            <option value="2">Prospecto B</option>
            <option value="3">Prospecto C</option>btnPresupuestoGeneral
          </select>
          
          <!-- Campos nuevos -->
          <label for="genFechaEnvio">Fecha de Envío:</label>
          <input type="date" id="genFechaEnvio" name="fecha_envio">
          
          <label for="genEstado">Estado:</label>
          <select id="genEstado" name="estado">
            <option value="">Seleccione un estado</option>
            <option value="en_curso" selected>En curso</option>
            <option value="pendiente">Pendiente</option>
            <option value="enviado">Enviado</option>
            <option value="aprobado">Aprobado</option>
          </select>
        </div>
        
        <!-- Paso 2: Parámetros Generales -->
        <div class="wizard-step" id="genStep2">
          <h3>Parámetros Generales del Presupuesto</h3>
          <label for="genTipoVidrio">Tipo de Vidrio:</label>
          <select id="genTipoVidrio" name="tipo_vidrio">
            <option value="">Seleccione</option>
            <option value="DVH">DVH</option>
            <option value="Crudo">Crudo</option>
            <option value="Laminado">Laminado</option>
          </select>
          
          <label for="genTipoInstalacion">Tipo de Instalación:</label>
          <select id="genTipoInstalacion" name="tipo_instalacion">
            <option value="">Seleccione</option>
            <option value="Interior">Interior</option>
            <option value="Exterior">Exterior</option>
          </select>
          
          <label for="genTipoProducto">Tipo de Producto:</label>
          <select id="genTipoProducto" name="tipo_producto">
            <option value="">Seleccione</option>
            <option value="Seguridad">Seguridad</option>
            <option value="Privacidad">Privacidad</option>
          </select>
          
          <!-- Botón para agregar "lámina" -->
          <button type="button" class="small-btn" onclick="addLaminaGeneral()">Agregar lámina</button>
          <div id="laminasContainerGeneral"></div>
          
          <!-- Sección para Medidas -->
          <h4>Medidas</h4>
          <!-- <button type="button" class="small-btn" onclick="addMedidaGeneral()">Agregar Medida</button>
          <div id="medidasContainerGeneral"></div> -->
          <div id="medidasContainerGeneral" class="medidas-container">
            <!-- Se agregarán las medidas dinámicamente aquí -->
          </div>
          <button type="button" class="btn-add-medida" onclick="addMedidaGeneral()">Agregar Medida</button>
          
        </div>
        
        <!-- Paso 3: Parámetros Adicionales -->
        <div class="wizard-step" id="genStep3">
          <h3>Parámetros Adicionales de Instalación</h3>
          
          <label for="genAyudante">Ayudante:</label>
          <input type="number" id="genAyudante" name="ayudante" placeholder="Ingrese cantidad">
          
          <div class="checkbox-group-col">
            <div class="checkbox-item">
              <label for="instTechos">Instalación en techos</label>
              <input type="checkbox" id="instTechos" name="inst_techos">
            </div>
            <div class="checkbox-item">
              <label for="instAltura">Instalación en altura</label>
              <input type="checkbox" id="instAltura" name="inst_altura">
            </div>
            <div class="checkbox-item">
              <label for="usoPergolas">Uso de pérgolas</label>
              <input type="checkbox" id="usoPergolas" name="uso_pergolas">
            </div>
            <div class="checkbox-item">
              <label for="usoSilletas">Uso de silletas</label>
              <input type="checkbox" id="usoSilletas" name="uso_silletas">
            </div>
            <div class="checkbox-item">
              <label for="vidrioRepartido">Vidrio repartido</label>
              <input type="checkbox" id="vidrioRepartido" name="vidrio_repartido">
            </div>
          </div>
          
          <div class="extra-space"></div>
          <label for="genEscaleras">Escaleras (cantidad):</label>
          <input type="number" id="genEscaleras" name="escaleras" placeholder="Cantidad">
          
          <label for="genAndamios">Andamios (cantidad):</label>
          <input type="number" id="genAndamios" name="andamios" placeholder="Cantidad">
          
          <!-- Ubicación de la obra -->
          <h4>Ubicación de la obra</h4>
          <div class="checkbox-group">
            <div>
              <input type="checkbox" id="genCABA" name="caba_gba">
              <label for="genCABA">CABA/GBA</label>
            </div>
            <div>
              <input type="checkbox" id="genInterior" name="obra_interior">
              <label for="genInterior">Interior del país</label>
            </div>
          </div>
          <div id="costoInterior" style="display: none;">
            <label for="genDias200km">Días a más de 200km:</label>
            <input type="number" id="genDias200km" name="dias200km" placeholder="Ingrese días">
          </div>
        </div>
        
        <!-- Paso 4: Resumen y Totales -->
        <div class="wizard-step" id="genStep4">
          <h3>Resumen y Totales</h3>
          <button type="button" class="small-btn" onclick="calcularTotalesGeneral()">Calcular</button>
          <div id="totales">
            <label for="areaTotal">Área Total (m²):</label>
            <input type="text" id="areaTotal" class="calc" readonly>
            
            <label for="metrosLineales">Metros Lineales:</label>
            <input type="text" id="metrosLineales" class="calc" readonly>
          </div>
          <div id="resumenGeneral">
            <!-- Se mostrará el resumen completo -->
          </div>
        </div>
        
        <!-- Botones de navegación para Formulario General -->
        <div class="button-group">
          <button type="button" class="btn" onclick="prevStep('gen')">Anterior</button>
          <button type="button" class="btn" onclick="nextStep('gen')">Siguiente</button>
          <button type="submit" class="btn">Guardar presupuesto general</button>
        </div>
      </form>
    </div>
    
    <!-- FORMULARIO PRESUPUESTO POR SECTOR -->
    <div id="formSector" class="hidden">
      <h2>Presupuesto por Sector</h2>
      <!-- Barra de progreso -->
      <ul class="progressbar" id="progressSector">
        <li class="active">Datos Generales</li>
        <li>Parámetros por Sector</li>
        <li>Parámetros Adicionales</li>
        <li>Resumen y Totales</li>
      </ul>
      
      <form id="wizardSector">
        <!-- Paso 1: Datos Generales y del Prospecto -->
        <div class="wizard-step active" id="secStep1">
          <h3>Datos Generales y del Prospecto</h3>
          <p class="explicacion">Utilice este presupuesto para proyectos por sector.</p>
          <label for="secNumeroPresupuesto">Número de Presupuesto:</label>
          <input type="text" id="secNumeroPresupuesto" name="numero_presupuesto" value="PR-2025-002" readonly>
          
          <label for="secFechaPresupuesto">Fecha de Presupuesto:</label>
          <input type="date" id="secFechaPresupuesto" name="fecha_presupuesto" value="2025-04-07" readonly>
          
          <label for="secVendedor">Vendedor:</label>
          <input type="text" id="secVendedor" name="vendedor" value="Juan Pérez" readonly>
          
          <label for="secEmpresa">Empresa:</label>
          <input type="text" id="secEmpresa" name="empresa" value="Empresa XYZ" readonly>
          
          <label for="secProspecto">Prospecto:</label>
          <select id="secProspecto" name="prospecto">
            <option value="">Seleccione un prospecto</option>
            <option value="1">Prospecto A</option>
            <option value="2">Prospecto B</option>
            <option value="3">Prospecto C</option>
          </select>
          
          <!-- Campos nuevos -->
          <label for="secFechaEnvio">Fecha de Envío:</label>
          <input type="date" id="secFechaEnvio" name="fecha_envio">
          
          <label for="secEstado">Estado:</label>
          <select id="secEstado" name="estado">
            <option value="">Seleccione un estado</option>
            <option value="en_curso" selected>En curso</option>
            <option value="pendiente">Pendiente</option>
            <option value="enviado">Enviado</option>
            <option value="aprobado">Aprobado</option>
          </select>
        </div>
        
        <!-- Paso 2: Parámetros por Sector -->
        <div class="wizard-step" id="secStep2">
          <h3>Parámetros por Sector</h3>
          <!-- Botón para agregar Sector -->
          <button type="button" class="small-btn" onclick="addSector()">Agregar Sector</button>
          <div id="sectorsContainer">
            <!-- Se agregarán sectores dinámicamente aquí -->
          </div>
        </div>
        
        <!-- Paso 3: Parámetros Adicionales de Instalación -->
        <div class="wizard-step" id="secStep3">
          <h3>Parámetros Adicionales de Instalación</h3>
          <label for="secAyudante">Ayudante:</label>
          <input type="number" id="secAyudante" name="ayudante" placeholder="Ingrese cantidad">
          
          <div class="checkbox-group-col">
            <div class="checkbox-item">
              <label for="secInstTechos">Instalación en techos</label>
              <input type="checkbox" id="secInstTechos" name="inst_techos">
              
            </div>
            <div class="checkbox-item">
              <label for="secInstAltura">Instalación en altura</label>
              <input type="checkbox" id="secInstAltura" name="inst_altura">
             
            </div>
            <div class="checkbox-item">
              <label for="secUsoPergolas">Uso de pérgolas</label>
              <input type="checkbox" id="secUsoPergolas" name="uso_pergolas">
              
            </div>
            <div class="checkbox-item">
              <label for="secUsoSilletas">Uso de silletas</label>
              <input type="checkbox" id="secUsoSilletas" name="uso_silletas">
              
            </div>
            <div class="checkbox-item">
              <label for="secVidrioRepartido">Vidrio repartido</label>
              <input type="checkbox" id="secVidrioRepartido" name="vidrio_repartido">
              
            </div>
          </div>
          
          <div class="extra-space"></div>
          <label for="secEscaleras">Escaleras (cantidad):</label>
          <input type="number" id="secEscaleras" name="escaleras" placeholder="Cantidad">
          
          <label for="secAndamios">Andamios (cantidad):</label>
          <input type="number" id="secAndamios" name="andamios" placeholder="Cantidad">
          
          <!-- Ubicación de la obra -->
          <h4>Ubicación de la obra</h4>
          <div class="checkbox-group">
            <div>
              <input type="checkbox" id="secCABA" name="caba_gba">
              <label for="secCABA">CABA/GBA</label>
            </div>
            <div>
              <input type="checkbox" id="secInterior" name="obra_interior">
              <label for="secInterior">Interior del país</label>
            </div>
          </div>
          <div id="costoInteriorSector" style="display: none;">
            <label for="secDias200km">Días a más de 200km:</label>
            <input type="number" id="secDias200km" name="dias200km" placeholder="Ingrese días">
          </div>
        </div>
        
        <!-- Paso 4: Resumen y Totales -->
        <div class="wizard-step" id="secStep4">
          <h3>Resumen y Totales</h3>
          <button type="button" class="small-btn" onclick="calcularTotalesSector()">Calcular</button>
          <div id="totalesSector">
            <label for="secAreaTotal">Área Total (m²):</label>
            <input type="text" id="secAreaTotal" class="calc" readonly>
            
            <label for="secMetrosLineales">Metros Lineales:</label>
            <input type="text" id="secMetrosLineales" class="calc" readonly>
          </div>
          <div id="resumenSector">
            <!-- Se mostrará el resumen completo -->
          </div>
        </div>
        
        <!-- Botones de navegación para Formulario Sector -->
        <div class="button-group">
          <button type="button" class="btn" onclick="prevStep('sec')">Anterior</button>
          <button type="button" class="btn" onclick="nextStep('sec')">Siguiente</button>
          <button type="submit" class="btn">Guardar presupuesto por sector</button>
        </div>
      </form>
    </div>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      /********* Variables y constantes globales *********/
      const conversionRate = 100; // Ejemplo: 100 ARS = 1 USD
      // Precios en ARS por m² para cada tipo de lámina
      const laminaPrices = {
        "Lámina A": 50,
        "Lámina B": 75,
        "Lámina C": 100
      };
      
      // Variables para el formulario General
      let genCurrentStep = 1;
      const totalGenSteps = 4;
      // Variables para el formulario Sector
      let secCurrentStep = 1;
      const totalSecSteps = 4;
      
      /********* Función para actualizar el step actual *********/
      function showStep(prefix, step) {
        const totalSteps = prefix === 'gen' ? totalGenSteps : totalSecSteps;
        for (let i = 1; i <= totalSteps; i++) {
          const stepElem = document.getElementById(prefix + "Step" + i);
          if(stepElem){
            stepElem.classList.toggle("active", i === step);
          }
        }
        // Actualizar la barra de progreso
        const progressBar = document.getElementById(prefix === 'gen' ? "progressGeneral" : "progressSector");
        const items = progressBar.getElementsByTagName("li");
        for (let i = 0; i < items.length; i++) {
          items[i].classList.toggle("active", i < step);
        }
      }

      
      function nextStep(prefix) {
        if (prefix === 'gen' && genCurrentStep < totalGenSteps) {
          genCurrentStep++;
          showStep('gen', genCurrentStep);
        } else if (prefix === 'sec' && secCurrentStep < totalSecSteps) {
          secCurrentStep++;
          showStep('sec', secCurrentStep);
        }
      }
      function prevStep(prefix) {
        if (prefix === 'gen' && genCurrentStep > 1) {
          genCurrentStep--;
          showStep('gen', genCurrentStep);
        } else if (prefix === 'sec' && secCurrentStep > 1) {
          secCurrentStep--;
          showStep('sec', secCurrentStep);
        }
      }
      
      /********* Mostrar/Ocultar "Días a más de 200km" *********/
      document.getElementById("genInterior").addEventListener("change", function() {
        document.getElementById("costoInterior").style.display = this.checked ? "block" : "none";
      });
      document.getElementById("secInterior").addEventListener("change", function() {
        document.getElementById("costoInteriorSector").style.display = this.checked ? "block" : "none";
      });
      
      /********* Funciones para el Formulario General *********/
      function addLaminaGeneral() {
        const container = document.getElementById("laminasContainerGeneral");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Lámina:</label>
          <select name="laminas[]">
            <option value="Lámina A">Lámina A</option>
            <option value="Lámina B">Lámina B</option>
            <option value="Lámina C">Lámina C</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar lámina</button>
        `;
        container.appendChild(div);
      }
      function addMedidaGeneral() {
        const container = document.getElementById("medidasContainerGeneral");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Ancho (m):</label>
          <input type="number" step="0.01" name="medida_ancho[]" placeholder="Ancho">
          <label>Alto (m):</label>
          <input type="number" step="0.01" name="medida_alto[]" placeholder="Alto">
          <label>Cantidad:</label>
          <input type="number" name="medida_cantidad[]" placeholder="Cantidad">
          <label>Despolarizado:</label>
          <select name="medida_despolarizado[]">
            <option value="true">Sí</option>
            <option value="false">No</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar Medida</button>
        `;
        container.appendChild(div);
      }
      
      // *** Genera una tabla de las medidas que se hayan agregado ***
      function buildMeasureTable(medidas) {
        let tableHtml = `
          <table class="measure-table">
            <thead>
              <tr>
                <th>Ancho (m)</th>
                <th>Alto (m)</th>
                <th>Cantidad</th>
                <th>Despolarizado</th>
              </tr>
            </thead>
            <tbody>
        `;
        medidas.forEach(m => {
          tableHtml += `
            <tr>
              <td>${m.ancho}</td>
              <td>${m.alto}</td>
              <td>${m.cantidad}</td>
              <td>${m.despolarizado ? 'Sí' : 'No'}</td>
            </tr>
          `;
        });
        tableHtml += `</tbody></table>`;
        return tableHtml;
      }
      
      function calcularTotalesGeneral() {
        let areaTotal = 0;
        let metrosLineales = 0;
        let measureData = []; // Para la tabla de resumen
        const medidas = document.querySelectorAll("#medidasContainerGeneral .dynamic-container");
        medidas.forEach(div => {
          const ancho = parseFloat(div.querySelector('input[name="medida_ancho[]"]').value) || 0;
          const alto = parseFloat(div.querySelector('input[name="medida_alto[]"]').value) || 0;
          const cantidad = parseInt(div.querySelector('input[name="medida_cantidad[]"]').value) || 0;
          const despValue = (div.querySelector('select[name="medida_despolarizado[]"]').value === "true");
          
          areaTotal += ancho * alto * cantidad;
          metrosLineales += ancho * cantidad;
          
          measureData.push({
            ancho: ancho.toFixed(2),
            alto: alto.toFixed(2),
            cantidad,
            despolarizado: despValue
          });
        });
        document.getElementById("areaTotal").value = areaTotal.toFixed(2);
        document.getElementById("metrosLineales").value = metrosLineales.toFixed(2);
        
        // Calcular importes por lámina
        let laminaCounts = {};
        const laminaContainers = document.querySelectorAll("#laminasContainerGeneral .dynamic-container");
        laminaContainers.forEach(div => {
          const selectElem = div.querySelector('select[name="laminas[]"]');
          if(selectElem) {
            const laminaType = selectElem.value;
            if(laminaType){
              if(!laminaCounts[laminaType]){
                laminaCounts[laminaType] = 0;
              }
              laminaCounts[laminaType]++;
            }
          }
        });
        
        let laminaResumen = "";
        for(let type in laminaCounts) {
          let count = laminaCounts[type];
          let price = laminaPrices[type] || 0;
          let importeARS = count * areaTotal * price;
          let importeUSD = importeARS / conversionRate;
          laminaResumen += `<p><strong>${type}</strong>: ${count} unidad(es); Importe ARS: $${importeARS.toFixed(2)} / US$ ${importeUSD.toFixed(2)}</p>`;
        }
        
        // Recopilar datos de todos los pasos
        let datosGenerales = `
          <p><strong>Número:</strong> ${document.getElementById("genNumeroPresupuesto").value}</p>
          <p><strong>Fecha Presupuesto:</strong> ${document.getElementById("genFechaPresupuesto").value}</p>
          <p><strong>Fecha Envío:</strong> ${document.getElementById("genFechaEnvio").value}</p>
          <p><strong>Estado:</strong> ${document.getElementById("genEstado").value}</p>
          <p><strong>Prospecto:</strong> ${document.getElementById("genProspecto").value}</p>
        `;
        let paramsGenerales = `
          <p><strong>Tipo de Vidrio:</strong> ${document.getElementById("genTipoVidrio").value}</p>
          <p><strong>Tipo de Instalación:</strong> ${document.getElementById("genTipoInstalacion").value}</p>
          <p><strong>Tipo de Producto:</strong> ${document.getElementById("genTipoProducto").value}</p>
        `;
        let paramsAdicionales = `
          <p><strong>Ayudante:</strong> ${document.getElementById("genAyudante").value}</p>
          <p><strong>Instalación en techos:</strong> ${document.getElementById("instTechos").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en altura:</strong> ${document.getElementById("instAltura").checked ? "Sí" : "No"}</p>
          <p><strong>Uso de pérgolas:</strong> ${document.getElementById("usoPergolas").checked ? "Sí" : "No"}</p>
          <p><strong>Uso de silletas:</strong> ${document.getElementById("usoSilletas").checked ? "Sí" : "No"}</p>
          <p><strong>Vidrio repartido:</strong> ${document.getElementById("vidrioRepartido").checked ? "Sí" : "No"}</p>
          <p><strong>Escaleras:</strong> ${document.getElementById("genEscaleras").value}</p>
          <p><strong>Andamios:</strong> ${document.getElementById("genAndamios").value}</p>
        `;
        let ubicacion = `
          <p><strong>CABA/GBA:</strong> ${document.getElementById("genCABA").checked ? "Sí" : "No"}</p>
          <p><strong>Interior del país:</strong> ${document.getElementById("genInterior").checked ? "Sí" : "No"}</p>
        `;
        if(document.getElementById("genInterior").checked){
          ubicacion += `<p><strong>Días a más de 200km:</strong> ${document.getElementById("genDias200km").value}</p>`;
        }
        
        // Construir la tabla de medidas
        let measureTableHtml = buildMeasureTable(measureData);
        
        const resumen = `
          <h4>Resumen Presupuesto General</h4>
          ${datosGenerales}
          ${paramsGenerales}
          ${paramsAdicionales}
          ${ubicacion}
          
          <h4>Medidas Ingresadas</h4>
          ${measureTableHtml}

          <p><strong>Área Total (m²):</strong> ${areaTotal.toFixed(2)}</p>
          <p><strong>Metros Lineales:</strong> ${metrosLineales.toFixed(2)}</p>

          <h4>Importe por Lámina</h4>
          ${laminaResumen}
        `;
        document.getElementById("resumenGeneral").innerHTML = resumen;
      }
      
      /********* Funciones para el Formulario Sector *********/
      let sectorCount = 0;
      function addSector() {
        const container = document.getElementById("sectorsContainer");
        const div = document.createElement("div");
        div.classList.add("sector-container");
        div.dataset.sectorIndex = sectorCount;
        div.innerHTML = `
          <h4>Sector ${sectorCount + 1}</h4>
          <label>Nombre del Sector:</label>
          <input type="text" name="sector_nombre[]" placeholder="Ingrese nombre del sector" required>
          
          <label>Tipo de Vidrio:</label>
          <select name="sector_tipo_vidrio[]" required>
            <option value="">Seleccione</option>
            <option value="DVH">DVH</option>
            <option value="Crudo">Crudo</option>
            <option value="Laminado">Laminado</option>
          </select>
          
          <label>Tipo de Instalación:</label>
          <select name="sector_tipo_instalacion[]" required>
            <option value="">Seleccione</option>
            <option value="Interior">Interior</option>
            <option value="Exterior">Exterior</option>
          </select>
          
          <label>Tipo de Producto:</label>
          <select name="sector_tipo_producto[]" required>
            <option value="">Seleccione</option>
            <option value="Seguridad">Seguridad</option>
            <option value="Privacidad">Privacidad</option>
          </select>
          
          <!-- Botón para agregar lámina dentro del sector -->
          <button type="button" class="small-btn" onclick="addLaminaInSector(this)">Agregar lámina</button>
          <div class="laminasContainerSector"></div>
          
          <!-- Sección para Medidas en el sector -->
          <h5>Medidas del Sector</h5>
          <div class="medidas-container">
            <div class="medidasContainerSector"></div>
          </div>
          <button type="button" class="btn-add-medida" onclick="addMedidaInSector(this)">Agregar Medida</button>

          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar Sector</button>
        `;
        container.appendChild(div);
        sectorCount++;
      }
      
      function addLaminaInSector(btn) {
        const container = btn.parentElement.querySelector(".laminasContainerSector");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Lámina:</label>
          <select name="sector_laminas[]">
            <option value="Lámina A">Lámina A</option>
            <option value="Lámina B">Lámina B</option>
            <option value="Lámina C">Lámina C</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar lámina</button>
        `;
        container.appendChild(div);
      }
      
      function addMedidaInSector(btn) {
        const container = btn.parentElement.querySelector(".medidasContainerSector");
        const div = document.createElement("div");
        div.classList.add("dynamic-container");
        div.innerHTML = `
          <label>Ancho (m):</label>
          <input type="number" step="0.01" name="sector_medida_ancho[]" placeholder="Ancho">
          <label>Alto (m):</label>
          <input type="number" step="0.01" name="sector_medida_alto[]" placeholder="Alto">
          <label>Cantidad:</label>
          <input type="number" name="sector_medida_cantidad[]" placeholder="Cantidad">
          <label>Despolarizado:</label>
          <select name="sector_medida_despolarizado[]">
            <option value="true">Sí</option>
            <option value="false">No</option>
          </select>
          <button type="button" class="small-btn" onclick="this.parentElement.remove()">Eliminar Medida</button>
        `;
        container.appendChild(div);
      }
      
      // *** Construye la tabla de medidas para el resumen
      function buildSectorMeasureTable(measures) {
        let tableHtml = `
          <table class="measure-table">
            <thead>
              <tr>
                <th>Ancho (m)</th>
                <th>Alto (m)</th>
                <th>Cantidad</th>
                <th>Despolarizado</th>
              </tr>
            </thead>
            <tbody>
        `;
        measures.forEach(m => {
          tableHtml += `
            <tr>
              <td>${m.ancho}</td>
              <td>${m.alto}</td>
              <td>${m.cantidad}</td>
              <td>${m.despolarizado ? 'Sí' : 'No'}</td>
            </tr>
          `;
        });
        tableHtml += `</tbody></table>`;
        return tableHtml;
      }
      
      function calcularTotalesSector() {
        let globalAreaTotal = 0;
        let globalMetrosLineales = 0;
        let sectorSummary = "";

        // Seleccionamos todos los sectores agregados
        const sectors = document.querySelectorAll("#sectorsContainer .sector-container");
        sectors.forEach((sectorDiv, idx) => {
          // Datos del sector
          const sectorName = sectorDiv.querySelector('input[name="sector_nombre[]"]').value || ("Sector " + (idx + 1));
          const tipoVidrio = sectorDiv.querySelector('select[name="sector_tipo_vidrio[]"]').value;
          const tipoInstalacion = sectorDiv.querySelector('select[name="sector_tipo_instalacion[]"]').value;
          const tipoProducto = sectorDiv.querySelector('select[name="sector_tipo_producto[]"]').value;
          
          // Variables para acumular cálculos en este sector
          let sectorArea = 0;
          let sectorMetros = 0;
          let measureData = [];
          // Recorre las medidas del sector
          const medidas = sectorDiv.querySelectorAll(".medidasContainerSector .dynamic-container");
          medidas.forEach(div => {
            const ancho = parseFloat(div.querySelector('input[name="sector_medida_ancho[]"]').value) || 0;
            const alto = parseFloat(div.querySelector('input[name="sector_medida_alto[]"]').value) || 0;
            const cantidad = parseInt(div.querySelector('input[name="sector_medida_cantidad[]"]').value) || 0;
            const despolarizado = (div.querySelector('select[name="sector_medida_despolarizado[]"]').value === "true");
            sectorArea += ancho * alto * cantidad;
            sectorMetros += ancho * cantidad;
            measureData.push({
              ancho: ancho.toFixed(2),
              alto: alto.toFixed(2),
              cantidad,
              despolarizado
            });
          });
          
          // Acumular totales globales (opcional)
          globalAreaTotal += sectorArea;
          globalMetrosLineales += sectorMetros;
          
          // Construir la tabla de medidas para el sector
          let measureTableHtml = buildSectorMeasureTable(measureData);
          
          // Calcular importes por lámina dentro de este sector
          let laminaCounts = {};
          const laminaContainers = sectorDiv.querySelectorAll(".laminasContainerSector .dynamic-container");
          laminaContainers.forEach(div => {
            const selectElem = div.querySelector('select[name="sector_laminas[]"]');
            if(selectElem) {
              let laminaType = selectElem.value;
              if(laminaType) {
                if (!laminaCounts[laminaType]) {
                  laminaCounts[laminaType] = 0;
                }
                laminaCounts[laminaType]++;
              }
            }
          });
          
          let laminaResumen = "";
          for (let type in laminaCounts) {
            let count = laminaCounts[type];
            let price = laminaPrices[type] || 0;
            // Suponemos: importe = número de láminas en el sector * área del sector * precio por m²
            let importeARS = count * sectorArea * price;
            let importeUSD = importeARS / conversionRate;
            laminaResumen += `<p><strong>${type}</strong>: ${count} unidad(es); Importe ARS: $${importeARS.toFixed(2)} / US$ ${importeUSD.toFixed(2)}</p>`;
          }
          
          // Agregar la información de este sector al resumen
          sectorSummary += `
            <div style="border: 1px solid #aaa; margin-top: 10px; padding: 5px;">
              <h5>${sectorName}</h5>
              <p><strong>Tipo de Vidrio:</strong> ${tipoVidrio}</p>
              <p><strong>Tipo de Instalación:</strong> ${tipoInstalacion}</p>
              <p><strong>Tipo de Producto:</strong> ${tipoProducto}</p>
              <h5>Medidas</h5>
              ${measureTableHtml}
              <p><strong>Área Total del Sector (m²):</strong> ${sectorArea.toFixed(2)}</p>
              <p><strong>Metros Lineales del Sector:</strong> ${sectorMetros.toFixed(2)}</p>
              <h5>Importe por Lámina</h5>
              ${laminaResumen}
            </div>
          `;
        });

        // Opcional: también se pueden asignar totales globales (si lo deseas)
        document.getElementById("secAreaTotal").value = globalAreaTotal.toFixed(2);
        document.getElementById("secMetrosLineales").value = globalMetrosLineales.toFixed(2);
        
        // Recopilar datos generales y parámetros adicionales globales
        let datosGenerales = `
          <p><strong>Número:</strong> ${document.getElementById("secNumeroPresupuesto").value}</p>
          <p><strong>Fecha Presupuesto:</strong> ${document.getElementById("secFechaPresupuesto").value}</p>
          <p><strong>Fecha Envío:</strong> ${document.getElementById("secFechaEnvio").value}</p>
          <p><strong>Estado:</strong> ${document.getElementById("secEstado").value}</p>
          <p><strong>Prospecto:</strong> ${document.getElementById("secProspecto").value}</p>
        `;
        let paramsAdicionales = `
          <p><strong>Ayudante:</strong> ${document.getElementById("secAyudante").value}</p>
          <p><strong>Instalación en techos:</strong> ${document.getElementById("secInstTechos").checked ? "Sí" : "No"}</p>
          <p><strong>Instalación en altura:</strong> ${document.getElementById("secInstAltura").checked ? "Sí" : "No"}</p>
          <p><strong>Uso de pérgolas:</strong> ${document.getElementById("secUsoPergolas").checked ? "Sí" : "No"}</p>
          <p><strong>Uso de silletas:</strong> ${document.getElementById("secUsoSilletas").checked ? "Sí" : "No"}</p>
          <p><strong>Vidrio repartido:</strong> ${document.getElementById("secVidrioRepartido").checked ? "Sí" : "No"}</p>
          <p><strong>Escaleras:</strong> ${document.getElementById("secEscaleras").value}</p>
          <p><strong>Andamios:</strong> ${document.getElementById("secAndamios").value}</p>
        `;
        let ubicacion = `
          <p><strong>CABA/GBA:</strong> ${document.getElementById("secCABA").checked ? "Sí" : "No"}</p>
          <p><strong>Interior del país:</strong> ${document.getElementById("secInterior").checked ? "Sí" : "No"}</p>
        `;
        if(document.getElementById("secInterior").checked){
          ubicacion += `<p><strong>Días a más de 200km:</strong> ${document.getElementById("secDias200km").value}</p>`;
        }
        
        const resumenGlobal = `
          <h4>Resumen Presupuesto por Sector (Global)</h4>
          ${datosGenerales}
          ${paramsAdicionales}
          ${ubicacion}
          <p><strong>Área Total Global (m²):</strong> ${globalAreaTotal.toFixed(2)}</p>
          <p><strong>Metros Lineales Global:</strong> ${globalMetrosLineales.toFixed(2)}</p>
        `;
        
        // Combinar resumen global y resumen por sector
        const resumenCompleto = `
          ${resumenGlobal}
          <hr>
          <h4>Resumen por Sectores</h4>
          ${sectorSummary}
        `;
        
        document.getElementById("resumenSector").innerHTML = resumenCompleto;
      }

      
      /********* Build measure table for sector *********/
      function buildSectorMeasureTable(measures) {
        let tableHtml = `
          <table class="measure-table">
            <thead>
              <tr>
                <th>Ancho (m)</th>
                <th>Alto (m)</th>
                <th>Cantidad</th>
                <th>Despolarizado</th>
              </tr>
            </thead>
            <tbody>
        `;
        measures.forEach(m => {
          tableHtml += `
            <tr>
              <td>${m.ancho}</td>
              <td>${m.alto}</td>
              <td>${m.cantidad}</td>
              <td>${m.despolarizado ? 'Sí' : 'No'}</td>
            </tr>
          `;
        });
        tableHtml += `</tbody></table>`;
        return tableHtml;
      }
      
      /********* Manejo de la pantalla de selección *********/
      // document.getElementById("btnPresupuestoGeneral").addEventListener("click", function() {
      //   document.getElementById("landingPage").classList.add("hidden");
      //   document.getElementById("formGeneral").classList.remove("hidden");
      //   genCurrentStep = 1;
      //   showStep('gen', genCurrentStep);
      // });
      // document.getElementById("btnPresupuestoSector").addEventListener("click", function() {
      //   document.getElementById("landingPage").classList.add("hidden");
      //   document.getElementById("formSector").classList.remove("hidden");
      //   secCurrentStep = 1;
      //   showStep('sec', secCurrentStep);
      // });
      document.getElementById("btnPresupuestoGeneral").addEventListener("click", function() {
      // Remueve completamente la pantalla inicial
      const landing = document.getElementById("landingPage");
      if (landing) {
        landing.remove();
      }
      // Muestra el formulario de Presupuesto General
      document.getElementById("formGeneral").style.display = "block";
      genCurrentStep = 1;
      showStep('gen', genCurrentStep);
    });

    document.getElementById("btnPresupuestoSector").addEventListener("click", function() {
      // Remueve completamente la pantalla inicial
      const landing = document.getElementById("landingPage");
      if (landing) {
        landing.remove();
      }
      // Muestra el formulario de Presupuesto por Sector
      document.getElementById("formSector").style.display = "block";
      secCurrentStep = 1;
      showStep('sec', secCurrentStep);
    });
      
      /********* Manejadores de envío (simulación) *********/
      document.getElementById("wizardGeneral").addEventListener("submit", function(e) {
        e.preventDefault();
        alert("Presupuesto General guardado (simulación)!");
      });
      document.getElementById("wizardSector").addEventListener("submit", function(e) {
        e.preventDefault();
        alert("Presupuesto por Sector guardado (simulación)!");
      });
      
      /********* Inicializar los primeros steps *********/
      showStep('gen', genCurrentStep);
      showStep('sec', secCurrentStep);
      
      /********* Exponer funciones globalmente para los atributos inline *********/
      window.showStep = showStep;
      window.nextStep = nextStep;
      window.prevStep = prevStep;
      window.addLaminaGeneral = addLaminaGeneral;
      window.addMedidaGeneral = addMedidaGeneral;
      window.calcularTotalesGeneral = calcularTotalesGeneral;
      window.addSector = addSector;
      window.addLaminaInSector = addLaminaInSector;
      window.addMedidaInSector = addMedidaInSector;
      window.calcularTotalesSector = calcularTotalesSector;
    });
  </script>
</body>
</html>
